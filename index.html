
<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Stock Research Repo</title>
  <meta name="description" content="ë‚´ ì£¼ì‹ ë¦¬ì„œì¹˜ ìë£Œë¥¼ ì •ë¦¬/ê²€ìƒ‰/ê³µìœ í•˜ëŠ” ì •ì  ì›¹ì‚¬ì´íŠ¸ í…œí”Œë¦¿">
  <meta name="theme-color" content="#0b0e14">
  <style>/* inlined clean theme */
:root{--bg:#0b0e14;--card:#121722;--muted:#8a98ad;--text:#e5eaf1;--accent:#60a5fa;--border:#2a3852}
:root[data-theme="light"]{--bg:#f7fafc;--card:#fff;--muted:#5a6473;--text:#0f172a;--border:#e5eaf1}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
a{color:var(--accent);text-decoration:none}
.app-header,.app-footer{border-bottom:1px solid var(--border);background:linear-gradient(180deg, rgba(13,18,28,.95), rgba(13,18,28,.9));padding:12px 16px;position:sticky;top:0;z-index:10}
:root[data-theme="light"] .app-header,:root[data-theme="light"] .app-footer{background:linear-gradient(180deg,#fff,#f8fafc)}
.app-footer{border-top:1px solid var(--border);border-bottom:none;text-align:center}
.logo{width:24px;height:24px}
.app-title{margin:0 0 0 6px;font-size:18px}
.top-nav{display:flex;gap:8px;flex-wrap:wrap}
.top-nav button{background:#121826;color:var(--text);border:1px solid var(--border);padding:6px 10px;border-radius:10px}
:root[data-theme="light"] .top-nav button{background:#f1f5f9}
.top-nav button.active{border-color:var(--accent);color:var(--accent)}
main{max-width:1000px;margin:20px auto;padding:0 14px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
.row{display:flex}.wrap{flex-wrap:wrap}.gap-s{gap:8px}.justify-between{justify-content:space-between}.align-center{align-items:center}.mt-s{margin-top:10px}
.grid{display:grid;gap:14px}.grid-2{grid-template-columns:repeat(2, minmax(0,1fr))}
@media(max-width:900px){.grid-2{grid-template-columns:1fr}}
input,textarea,select,button{background:#0f1520;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px}
:root[data-theme="light"] input,:root[data-theme="light"] textarea,:root[data-theme="light"] select,:root[data-theme="light"] button{background:#fff}
button{cursor:pointer}button.primary{background:var(--accent);color:#0b0e14;border-color:transparent;font-weight:600}
button.ghost{background:transparent;border:1px solid var(--border)}
.table-wrap{overflow:auto;border:1px solid var(--border);border-radius:12px}
table{border-collapse:separate;border-spacing:0;width:100%}
th,td{padding:8px;border-bottom:1px solid var(--border);vertical-align:top}
th{position:sticky;top:0;background:#0f1520;text-align:left}:root[data-theme="light"] th{background:#f8fafc}
.badge{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--accent);margin-right:4px}
.muted{color:var(--muted)}
.section{display:none}.section.visible{display:block}
.note-cards{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;padding:0;list-style:none}
@media(max-width:900px){.note-cards{grid-template-columns:1fr}}
.note-cards li{border:1px solid var(--border);border-radius:12px;padding:10px;background:#0f1520}
:root[data-theme="light"] .note-cards li{background:#fff}
kbd{border:1px solid var(--border);padding:0 6px;border-radius:6px;background:#0f1520}
@media print{body{background:#fff;color:#000}.app-header,.app-footer{display:none}main{max-width:800px}.card{box-shadow:none;border-color:#bbb}a{color:#000;text-decoration:underline}}</style>
</head>
<body>
  <header class="app-header">
    <div class="row justify-between align-center wrap">
      <h1 class="app-title">ğŸ“š Stock Research Repo</h1>
      <nav class="top-nav" aria-label="ì£¼ìš” ì„¹ì…˜">
        <button data-section="dashboard" class="active" title="g d">ëŒ€ì‹œë³´ë“œ</button>
        <button data-section="watchlist" title="g w">ì›Œì¹˜ë¦¬ìŠ¤íŠ¸</button>
        <button data-section="notes" title="g n">ë¦¬ì„œì¹˜ ë…¸íŠ¸</button>
        <button data-section="links" title="g l">ìë£Œ ë§í¬</button>
        <button data-section="settings">ë°±ì—…/ì„¤ì •</button>
      </nav>
      <div class="row gap-s">
        <button id="themeToggle" class="ghost" aria-label="í…Œë§ˆ ì „í™˜">ğŸŒ“</button>
      </div>
    </div>
  </header>

  <main>
    <section id="dashboard" class="section visible">
      <div class="grid">
        <div class="card">
          <h2>ë¹ ë¥¸ ì¶”ê°€</h2>
          <div class="grid grid-2">
            <div>
              <h3>í‹°ì»¤ ì¶”ê°€</h3>
              <form id="quickAddTicker" class="stack gap-s">
                <input required name="symbol" placeholder="í‹°ì»¤ (ì˜ˆ: AAPL, NVDA)" autocomplete="off">
                <input name="name" placeholder="íšŒì‚¬ëª… (ì„ íƒ)">
                <input name="sector" placeholder="ì„¹í„° (ì„ íƒ)">
                <input name="tags" placeholder="íƒœê·¸ (ì‰¼í‘œêµ¬ë¶„)">
                <input name="target" type="number" step="0.01" placeholder="ëª©í‘œê°€ (ì„ íƒ)">
                <textarea name="thesis" rows="3" placeholder="ê°„ë‹¨ íˆ¬ì ì•„ì´ë””ì–´ (ì„ íƒ)"></textarea>
                <button type="submit" class="primary">ì¶”ê°€</button>
              </form>
            </div>
            <div>
              <h3>ë…¸íŠ¸ ì¶”ê°€</h3>
              <form id="quickAddNote" class="stack gap-s">
                <input required name="title" placeholder="ì œëª©">
                <input name="symbol" placeholder="ê´€ë ¨ í‹°ì»¤ (ì„ íƒ)">
                <input name="tags" placeholder="íƒœê·¸ (ì‰¼í‘œêµ¬ë¶„)">
                <textarea required name="content" rows="5" placeholder="í•µì‹¬ ìš”ì•½ / í•™ìŠµ ë‚´ìš© / ë¦¬ìŠ¤í¬ ë“±"></textarea>
                <button type="submit" class="primary">ì¶”ê°€</button>
              </form>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>ìµœê·¼ ë…¸íŠ¸</h2>
          <ul id="recentNotes" class="list"></ul>
        </div>

        <div class="card">
          <h2>ê²€ìƒ‰ <span class="muted">(ë‹¨ì¶•í‚¤: / )</span></h2>
          <input id="globalSearch" placeholder="í‹°ì»¤/íšŒì‚¬/íƒœê·¸/ë…¸íŠ¸ ë‚´ìš© ê²€ìƒ‰â€¦">
          <ul id="searchResults" class="list"></ul>
        </div>
      </div>
    </section>

    <section id="watchlist" class="section">
      <div class="card">
        <div class="row justify-between align-center">
          <h2>ì›Œì¹˜ë¦¬ìŠ¤íŠ¸</h2>
          <div class="row gap-s wrap">
            <input id="watchlistFilter" placeholder="í‹°ì»¤/íƒœê·¸/ì„¹í„° í•„í„°">
            <button id="exportCSV">CSV ë‚´ë³´ë‚´ê¸°</button>
            <label class="ghost"><input type="file" id="csvUpload" accept=".csv,text/csv" hidden> CSV ì—…ë¡œë“œ</label>
          </div>
        </div>
        <div class="table-wrap">
          <table id="watchlistTable">
            <thead>
              <tr>
                <th data-sort="symbol">í‹°ì»¤</th>
                <th data-sort="name">íšŒì‚¬ëª…</th>
                <th data-sort="sector">ì„¹í„°</th>
                <th>íƒœê·¸</th>
                <th data-sort="target" class="num">ëª©í‘œê°€</th>
                <th>ì•„ì´ë””ì–´</th>
                <th>ë©”ëª¨</th>
                <th>ì‘ì—…</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="row justify-between align-center mt-s">
          <div class="muted" id="watchlistMeta"></div>
          <div class="pagination">
            <button id="prevPage" class="ghost">ì´ì „</button>
            <span id="pageInfo" class="muted"></span>
            <button id="nextPage" class="ghost">ë‹¤ìŒ</button>
          </div>
        </div>
      </div>
    </section>

    <section id="notes" class="section">
      <div class="card">
        <div class="row justify-between align-center">
          <h2>ë¦¬ì„œì¹˜ ë…¸íŠ¸</h2>
          <div class="row gap-s wrap">
            <input id="noteFilter" placeholder="ì œëª©/ë³¸ë¬¸/íƒœê·¸/í‹°ì»¤ ê²€ìƒ‰">
            <button id="exportMd" class="ghost">Markdown ë‚´ë³´ë‚´ê¸°</button>
          </div>
        </div>
        <ul id="notesList" class="note-cards"></ul>
      </div>
    </section>

    <section id="links" class="section">
      <div class="card">
        <h2>ìë£Œ ë§í¬</h2>
        <form id="addLink" class="row gap-s wrap">
          <input required name="title" placeholder="ì œëª©">
          <input required name="url" placeholder="URL (https://â€¦)">
          <input name="desc" placeholder="ì„¤ëª… (ì„ íƒ)">
          <input name="tags" placeholder="íƒœê·¸ (ì‰¼í‘œêµ¬ë¶„)">
          <button type="submit">ì¶”ê°€</button>
        </form>
        <ul id="linksList" class="list mt-s"></ul>
      </div>
    </section>

    <section id="settings" class="section">
      <div class="card">
        <h2>ë°±ì—… & ë³µì›</h2>
        <div class="row gap-s wrap">
          <button id="downloadJSON" class="primary">ì „ì²´ ë°ì´í„° JSON ë‹¤ìš´ë¡œë“œ</button>
          <label class="ghost"><input type="file" id="uploadJSON" accept="application/json" hidden> JSON ë¶ˆëŸ¬ì˜¤ê¸°</label>
          <button id="remoteSync">ì›ê²© ë™ê¸°í™”(data/seed.json)</button>
        </div>
        <p class="muted mt-s">â€¢ ì´ˆê¸° ë¡œë“œ ì‹œ ë¡œì»¬ ë°ì´í„°ê°€ ë¹„ì–´ ìˆìœ¼ë©´ <code>data/seed.json</code>ì„ ìë™ ì‹œë„í•©ë‹ˆë‹¤.<br>â€¢ â€œì›ê²© ë™ê¸°í™”â€ëŠ” í˜„ì¬ ë°ì´í„°ë¥¼ <code>data/seed.json</code>ìœ¼ë¡œ êµì²´í•©ë‹ˆë‹¤.</p>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <span>Â© 2025 Stock Research Repo Â· Static HTML</span>
  </footer>

  <script>
  const STORAGE_KEY="steper_stock_repo_v1";
  const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
  function load(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY))||{tickers:[],notes:[],links:[],createdAt:Date.now()}}catch{return {tickers:[],notes:[],links:[],createdAt:Date.now()}}}
  function save(st){ localStorage.setItem(STORAGE_KEY, JSON.stringify(st)); }
  let state=load();

  function applyTheme(t){ document.documentElement.setAttribute("data-theme", t); localStorage.setItem("theme", t); }
  applyTheme(localStorage.getItem("theme")||"dark");
  $("#themeToggle").addEventListener("click",()=>applyTheme((localStorage.getItem("theme")||"dark")==="dark"?"light":"dark"));

  $$(".top-nav button").forEach(btn=>btn.addEventListener("click",()=>showSection(btn.dataset.section)));
  function showSection(id){
    $$(".top-nav button").forEach(b=>b.classList.toggle("active", b.dataset.section===id));
    $$(".section").forEach(s=>s.classList.remove("visible"));
    document.getElementById(id).classList.add("visible");
  }

  (async function seedOnce(){
    if(state.tickers.length||state.notes.length||state.links.length) return;
    try{ const res=await fetch('data/seed.json?ts='+Date.now(),{cache:'no-store'});
      if(res.ok){ const s=await res.json(); if(s && (s.tickers||s.notes||s.links)){ state=s; save(state); }}
    }catch(_){}
    renderAll();
  })();

  function bindDashboard(){
    document.getElementById("quickAddTicker").addEventListener("submit",(e)=>{
      e.preventDefault();
      const fd=new FormData(e.target);
      const tk={id:crypto.randomUUID(),symbol:fd.get('symbol').trim().toUpperCase(),name:(fd.get('name')||'').trim(),sector:(fd.get('sector')||'').trim(),tags:(fd.get('tags')||'').split(',').map(s=>s.trim()).filter(Boolean),target:fd.get('target')?Number(fd.get('target')):null,thesis:(fd.get('thesis')||'').trim(),notes:'',createdAt:Date.now(),updatedAt:Date.now()};
      if(!tk.symbol) return alert('í‹°ì»¤ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
      state.tickers.unshift(tk); save(state); renderWatchlist(); renderRecentNotes(); alert('ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.'); e.target.reset();
    });
    document.getElementById("quickAddNote").addEventListener("submit",(e)=>{
      e.preventDefault();
      const fd=new FormData(e.target);
      const note={id:crypto.randomUUID(),title:(fd.get('title')||'').trim(),symbol:(fd.get('symbol')||'').trim().toUpperCase(),tags:(fd.get('tags')||'').split(',').map(s=>s.trim()).filter(Boolean),content:(fd.get('content')||'').trim(),createdAt:Date.now(),updatedAt:Date.now()};
      if(!note.title||!note.content) return alert('ì œëª©ê³¼ ë³¸ë¬¸ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
      state.notes.unshift(note); save(state); renderRecentNotes(); renderNotesList(); e.target.reset();
    });
    document.addEventListener('keydown',(e)=>{ if(e.key==='/'){ e.preventDefault(); document.getElementById("globalSearch").focus(); }});
    document.getElementById("globalSearch").addEventListener("input",(e)=>{
      const q=e.target.value.trim().toLowerCase(); const list=document.getElementById("searchResults"); list.innerHTML=''; if(!q) return;
      const inT=state.tickers.filter(t=>(t.symbol+t.name+t.sector+t.tags.join(',')+t.thesis+(t.notes||'')).toLowerCase().includes(q));
      const inN=state.notes.filter(n=>(n.title+n.content+n.symbol+n.tags.join(',')).toLowerCase().includes(q));
      const inL=state.links.filter(l=>(l.title+l.url+(l.desc||'')+l.tags.join(',')).toLowerCase().includes(q));
      [...inT.map(t=>({type:'í‹°ì»¤',label:`${t.symbol} ${t.name||''}`,extra:t.sector})),...inN.map(n=>({type:'ë…¸íŠ¸',label:n.title,extra:n.symbol})),...inL.map(l=>({type:'ë§í¬',label:l.title,extra:l.url}))].slice(0,20).forEach(r=>{
        const li=document.createElement('li'); li.innerHTML=`<span class="badge">${r.type}</span> <strong>${r.label}</strong> <span class="muted">${r.extra||''}</span>`; list.appendChild(li);
      });
    });
  }
  function renderRecentNotes(){
    const ul=document.getElementById("recentNotes"); ul.innerHTML='';
    state.notes.slice(0,8).forEach(n=>{ const li=document.createElement('li'); li.innerHTML=`<strong>${n.title}</strong> <span class="muted">Â· ${hDate(n.updatedAt)} ${n.symbol? 'Â· '+n.symbol:''}</span><br>${n.content.slice(0,160)}${n.content.length>160?'â€¦':''}`; ul.appendChild(li); });
  }

  let sortKey='symbol', sortAsc=true, page=1, pageSize=10;
  function filterSortTickers(){
    const q=(document.getElementById("watchlistFilter")?.value||'').toLowerCase();
    const arr=state.tickers.filter(t=>(t.symbol+t.name+t.sector+t.tags.join(',')).toLowerCase().includes(q));
    return arr.sort((a,b)=>{
      let va=a[sortKey], vb=b[sortKey];
      if(sortKey==='target'){ va=va??-Infinity; vb=vb??-Infinity; return sortAsc?(va-vb):(vb-va); }
      va=(va||'').toString().toLowerCase(); vb=(vb||'').toString().toLowerCase();
      if(va<vb) return sortAsc?-1:1; if(va>vb) return sortAsc?1:-1; return 0;
    });
  }
  function renderWatchlist(){
    const tbody=document.querySelector("#watchlistTable tbody"); const rows=filterSortTickers(); const total=rows.length;
    const totalPages=Math.max(1,Math.ceil(total/pageSize)); if(page>totalPages) page=totalPages;
    const start=(page-1)*pageSize; const slice=rows.slice(start,start+pageSize);
    tbody.innerHTML='';
    slice.forEach(t=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td><strong>${t.symbol}</strong></td>
        <td>${t.name||''}</td>
        <td>${t.sector||''}</td>
        <td>${(t.tags||[]).map(tag=>'<span class="badge">#'+tag+'</span>').join(' ')}</td>
        <td class="num">${t.target ?? ''}</td>
        <td>${t.thesis||''}</td>
        <td contenteditable data-id="${t.id}" data-field="notes">${t.notes||''}</td>
        <td><button data-edit="${t.id}">í¸ì§‘</button> <button data-del="${t.id}">ì‚­ì œ</button></td>`;
      tbody.appendChild(tr);
    });
    document.getElementById("watchlistMeta").textContent=`${total}ê°œ Â· ${page}/${totalPages} í˜ì´ì§€ Â· ì •ë ¬: ${sortKey} ${sortAsc?'â†‘':'â†“'}`;
    document.getElementById("pageInfo").textContent=`${page} / ${totalPages}`;
  }
  function bindWatchlist(){
    document.getElementById("watchlistFilter").addEventListener("input",()=>{ page=1; renderWatchlist(); });
    document.getElementById("prevPage").addEventListener("click",()=>{ page=Math.max(1,page-1); renderWatchlist(); });
    document.getElementById("nextPage").addEventListener("click",()=>{ const totalPages=Math.max(1,Math.ceil(filterSortTickers().length/pageSize)); page=Math.min(totalPages,page+1); renderWatchlist(); });
    document.querySelectorAll("#watchlistTable th[data-sort]").forEach(th=>th.addEventListener("click",()=>{ const key=th.getAttribute('data-sort'); if(sortKey===key) sortAsc=!sortAsc; else {sortKey=key; sortAsc=true;} renderWatchlist(); }));
    document.getElementById("watchlistTable").addEventListener("input",(e)=>{ const cell=e.target.closest("[contenteditable]"); if(!cell) return; const id=cell.dataset.id, field=cell.dataset.field; const tk=state.tickers.find(x=>x.id===id); if(!tk) return; tk[field]=cell.innerText.trim(); tk.updatedAt=Date.now(); save(state); });
    document.getElementById("watchlistTable").addEventListener("click",(e)=>{
      const delId=e.target.getAttribute('data-del'), editId=e.target.getAttribute('data-edit');
      if(delId){ if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){ state.tickers=state.tickers.filter(t=>t.id!==delId); save(state); renderWatchlist(); } }
      else if(editId){ const t=state.tickers.find(x=>x.id===editId); if(!t) return;
        const name=prompt('íšŒì‚¬ëª…', t.name||'') ?? t.name;
        const sector=prompt('ì„¹í„°', t.sector||'') ?? t.sector;
        const tags=prompt('íƒœê·¸(ì‰¼í‘œ êµ¬ë¶„)', (t.tags||[]).join(',')) ?? (t.tags||[]).join(',');
        const target=prompt('ëª©í‘œê°€', t.target ?? '') ?? (t.target ?? '');
        const thesis=prompt('ì•„ì´ë””ì–´', t.thesis||'') ?? t.thesis;
        Object.assign(t,{name:name?.trim(),sector:sector?.trim(),tags:(tags||'').split(',').map(s=>s.trim()).filter(Boolean),target:target!==''?Number(target):null,thesis:thesis?.trim(),updatedAt:Date.now()});
        save(state); renderWatchlist();
      }
    });
    document.getElementById("exportCSV").addEventListener("click",()=>{
      const headers=["symbol","name","sector","tags","target","thesis","notes"];
      const rows=state.tickers.map(t=>[t.symbol,t.name||"",t.sector||"", (t.tags||[]).join(";"), t.target??"", (t.thesis||"").replace(/\n/g," "), (t.notes||"").replace(/\n/g," ")]);
      const csv=[headers.join(","), ...rows.map(r=>r.map(s=>String(s).includes(",")?'"'+String(s).replace(/"/g,'""')+'"':s).join(","))].join("\n");
      const a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"})); a.download="watchlist.csv"; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); },0);
    });
    document.getElementById("csvUpload").addEventListener("change",(e)=>{
      const file=e.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>{
        const text=reader.result; const lines=text.split(/\r?\n/).filter(Boolean); const header=lines.shift().split(",");
        const idx=name=>header.findIndex(h=>h.trim().toLowerCase()===name);
        for(const line of lines){ const cols=parseCSV(line); const tk={id:crypto.randomUUID(),symbol:(cols[idx("symbol")]||"").trim().toUpperCase(),name:(cols[idx("name")]||"").trim(),sector:(cols[idx("sector")]||"").trim(),tags:(cols[idx("tags")]||"").split(/[;,]/).map(s=>s.trim()).filter(Boolean),target:(cols[idx("target")]||"")===""?null:Number(cols[idx("target")]),thesis:(cols[idx("thesis")]||"").trim(),notes:(cols[idx("notes")]||"").trim(),createdAt:Date.now(),updatedAt:Date.now()};
          if(!tk.symbol) continue; const ex=state.tickers.find(x=>x.symbol===tk.symbol);
          if(ex){ Object.assign(ex,tk,{id:ex.id,createdAt:ex.createdAt,updatedAt:Date.now()}); } else { state.tickers.push(tk); }
        }
        save(state); renderWatchlist(); alert("CSVë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
      }; reader.readAsText(file);
    });
  }

  function bindNotes(){ document.getElementById("noteFilter").addEventListener("input", renderNotesList); }
  function renderNotesList(){
    const q=(document.getElementById("noteFilter")?.value||'').toLowerCase(); const ul=document.getElementById("notesList"); ul.innerHTML='';
    state.notes.filter(n=>(n.title+n.content+n.symbol+n.tags.join(',')).toLowerCase().includes(q)).forEach(n=>{
      const li=document.createElement('li');
      li.innerHTML='<div class="row justify-between"><div><strong>'+n.title+'</strong> '+(n.symbol?'<span class="badge">'+n.symbol+'</span>':'')+'</div><div class="muted">'+hDate(n.updatedAt)+' Â· '+(n.tags||[]).map(t=>'#'+t).join(' ')+'</div></div><div class="mt-s">'+n.content.replace(/\n/g,"<br>")+'</div>';
      ul.appendChild(li);
    });
  }
  function bindLinks(){
    document.getElementById("addLink").addEventListener("submit",(e)=>{
      e.preventDefault(); const fd=new FormData(e.target);
      const link={id:crypto.randomUUID(),title:fd.get("title").trim(),url:fd.get("url").trim(),desc:(fd.get("desc")||"").trim(),tags:(fd.get("tags")||"").split(",").map(s=>s.trim()).filter(Boolean),createdAt:Date.now(),updatedAt:Date.now()};
      try{ new URL(link.url); }catch{ return alert("URL í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); }
      state.links.unshift(link); save(state); renderLinksList(); e.target.reset();
    });
  }
  function renderLinksList(){
    const ul=document.getElementById("linksList"); ul.innerHTML='';
    state.links.forEach(l=>{ const li=document.createElement('li'); li.innerHTML='<a href="'+l.url+'" target="_blank" rel="noopener">'+l.title+'</a> '+((l.tags||[]).length?'<span class="muted"> Â· '+(l.tags||[]).map(t=>'#'+t).join(' ')+'</span>':'')+' <div class="muted">'+(l.desc||"")+'</div>'; ul.appendChild(li); });
  }

  function bindSettings(){
    document.getElementById("downloadJSON").addEventListener("click",()=>{
      const a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([JSON.stringify(state,null,2)],{type:"application/json"})); a.download="steper-stock.json"; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); },0);
    });
    document.getElementById("uploadJSON").addEventListener("change",(e)=>{
      const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{
        try{ const incoming=JSON.parse(r.result); if(!incoming||typeof incoming!=="object") throw new Error("bad"); state=incoming; save(state); alert("JSONì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤."); renderAll(); }
        catch{ alert("ìœ íš¨í•œ JSONì´ ì•„ë‹™ë‹ˆë‹¤."); }
      }; r.readAsText(f);
    });
    document.getElementById("remoteSync").addEventListener("click", async ()=>{
      try{ const res=await fetch('data/seed.json?ts='+Date.now(),{cache:'no-store'});
        if(!res.ok) return alert('data/seed.jsonì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
        const incoming=await res.json();
        if(!incoming||typeof incoming!=='object') return alert('seed.json í˜•ì‹ ì˜¤ë¥˜');
        state=incoming; save(state); alert('ì›ê²© ë°ì´í„°ë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤.'); renderAll();
      }catch(e){ alert('ì›ê²© ë™ê¸°í™” ì‹¤íŒ¨: ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” CORS'); }
    });
  }

  function hDate(ts){ const d=new Date(ts); const p=n=>String(n).padStart(2,"0"); return d.getFullYear()+"-"+p(d.getMonth()+1)+"-"+p(d.getDate())+" "+p(d.getHours())+":"+p(d.getMinutes()); }
  function parseCSV(line){ const out=[]; let cur="",inQ=false; for(let i=0;i<line.length;i++){ const ch=line[i]; if(ch==='"'){ if(inQ && line[i+1]==='"'){ cur+='"'; i++; } else inQ=!inQ; } else if(ch===',' && !inQ){ out.push(cur); cur=""; } else cur+=ch; } out.push(cur); return out; }

  function renderAll(){ renderWatchlist(); renderRecentNotes(); renderNotesList(); renderLinksList(); }
  bindDashboard(); bindWatchlist(); bindNotes(); bindLinks(); bindSettings(); renderAll();
  </script>
</body>
</html>
